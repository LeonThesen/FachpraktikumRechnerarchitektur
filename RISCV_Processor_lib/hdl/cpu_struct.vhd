--
-- VHDL Architecture RISCV_Processor_lib.cpu.struct
--
-- Created:
--          by - st161569.st161569 (pc043)
--          at - 17:12:41 05/22/24
--
-- Generated by Mentor Graphics' HDL Designer(TM) 2022.3 Built on 14 Jul 2022 at 13:56:12
--
LIBRARY ieee;
USE ieee.std_logic_1164.all;
USE ieee.numeric_std.all;
LIBRARY RISCV_Processor_lib;
USE RISCV_Processor_lib.types.ALL;


ARCHITECTURE struct OF cpu IS

   -- Architecture declarations

   -- Internal signal declarations
   SIGNAL alu_mode_dc         : alu_mode_t;
   SIGNAL alu_mode_ex         : alu_mode_t;
   SIGNAL alu_result_ex       : word_t;
   SIGNAL alu_result_mem      : word_t;
   SIGNAL data_memory_result  : word_t;
   SIGNAL fwd_rs1_dc          : fwd_select_t;
   SIGNAL fwd_rs1_ex          : fwd_select_t;
   SIGNAL fwd_rs2_dc          : fwd_select_t;
   SIGNAL fwd_rs2_ex          : fwd_select_t;
   SIGNAL fwd_store_data_dc   : std_logic;
   SIGNAL fwd_store_data_ex   : std_logic;
   SIGNAL fwd_store_data_mem  : std_logic;
   SIGNAL imm_dc              : word_t;
   SIGNAL imm_ex              : word_t;
   SIGNAL imm_to_alu_dc       : std_logic;
   SIGNAL imm_to_alu_ex       : std_logic;
   SIGNAL instruction_word_dc : word_t;
   SIGNAL instruction_word_if : word_t;
   SIGNAL mem_mode_dc         : mem_mode_t;
   SIGNAL mem_mode_ex         : mem_mode_t;
   SIGNAL mem_mode_mem        : mem_mode_t;
   SIGNAL mem_result_mem      : word_t;
   SIGNAL mem_result_wb       : word_t;
   SIGNAL operand_a           : word_t;
   SIGNAL operand_b           : word_t;
   SIGNAL pc_if               : std_logic_vector(7 DOWNTO 0);
   SIGNAL pc_pf               : std_logic_vector(7 DOWNTO 0);
   SIGNAL rd_addr_dc          : register_file_t;
   SIGNAL rd_addr_ex          : register_file_t;
   SIGNAL rd_addr_mem         : register_file_t;
   SIGNAL rd_addr_wb          : register_file_t;
   SIGNAL rs1_addr            : register_file_t;
   SIGNAL rs1_dc              : word_t;
   SIGNAL rs1_ex              : word_t;
   SIGNAL rs2_addr            : register_file_t;
   SIGNAL rs2_dc              : word_t;
   SIGNAL rs2_ex              : word_t;
   SIGNAL rs2_fwd_mux_out     : word_t;
   SIGNAL rs2_mem             : word_t;
   SIGNAL stall_dc            : std_logic;
   SIGNAL store_data          : word_t;


   -- Component Declarations
   COMPONENT alu
   PORT (
      alu_mode_ex   : IN     alu_mode_t ;
      operand_a     : IN     word_t ;
      operand_b     : IN     word_t ;
      alu_result_ex : OUT    word_t 
   );
   END COMPONENT;
   COMPONENT data_memory
   PORT (
      alu_result_mem     : IN     word_t ;
      clk                : IN     std_logic ;
      mem_mode_mem       : IN     mem_mode_t ;
      res_n              : IN     std_logic ;
      store_data         : IN     word_t ;
      data_memory_result : OUT    word_t 
   );
   END COMPONENT;
   COMPONENT dc_ex_pipeline_reg
   PORT (
      alu_mode_dc       : IN     alu_mode_t ;
      clk               : IN     std_logic ;
      fwd_rs1_dc        : IN     fwd_select_t ;
      fwd_rs2_dc        : IN     fwd_select_t ;
      fwd_store_data_dc : IN     std_logic ;
      imm_dc            : IN     word_t ;
      imm_to_alu_dc     : IN     std_logic ;
      mem_mode_dc       : IN     mem_mode_t ;
      rd_addr_dc        : IN     register_file_t ;
      res_n             : IN     std_logic ;
      rs1_dc            : IN     word_t ;
      rs2_dc            : IN     word_t ;
      alu_mode_ex       : OUT    alu_mode_t ;
      fwd_rs1_ex        : OUT    fwd_select_t ;
      fwd_rs2_ex        : OUT    fwd_select_t ;
      fwd_store_data_ex : OUT    std_logic ;
      imm_ex            : OUT    word_t ;
      imm_to_alu_ex     : OUT    std_logic ;
      mem_mode_ex       : OUT    mem_mode_t ;
      rd_addr_ex        : OUT    register_file_t ;
      rs1_ex            : OUT    word_t ;
      rs2_ex            : OUT    word_t 
   );
   END COMPONENT;
   COMPONENT decoder
   PORT (
      instruction_word_dc : IN     word_t ;
      mem_mode_ex         : IN     mem_mode_t ;
      rd_addr_ex          : IN     register_file_t ;
      rd_addr_mem         : IN     register_file_t ;
      alu_mode_dc         : OUT    alu_mode_t ;
      fwd_rs1_dc          : OUT    fwd_select_t ;
      fwd_rs2_dc          : OUT    fwd_select_t ;
      fwd_store_data_dc   : OUT    std_logic ;
      imm_dc              : OUT    word_t ;
      imm_to_alu_dc       : OUT    std_logic ;
      mem_mode_dc         : OUT    mem_mode_t ;
      rd_addr_dc          : OUT    register_file_t ;
      rs1_addr            : OUT    register_file_t ;
      rs2_addr            : OUT    register_file_t ;
      stall_dc            : OUT    std_logic 
   );
   END COMPONENT;
   COMPONENT ex_mem_pipeline_reg
   PORT (
      alu_result_ex      : IN     word_t ;
      clk                : IN     std_logic ;
      fwd_store_data_ex  : IN     std_logic ;
      mem_mode_ex        : IN     mem_mode_t ;
      rd_addr_ex         : IN     register_file_t ;
      res_n              : IN     std_logic ;
      rs2_fwd_mux_out    : IN     word_t ;
      alu_result_mem     : OUT    word_t ;
      fwd_store_data_mem : OUT    std_logic ;
      mem_mode_mem       : OUT    mem_mode_t ;
      rd_addr_mem        : OUT    register_file_t ;
      rs2_mem            : OUT    word_t 
   );
   END COMPONENT;
   COMPONENT if_dc_pipeline_reg
   PORT (
      clk                 : IN     std_logic ;
      instruction_word_if : IN     word_t ;
      res_n               : IN     std_logic ;
      stall_dc            : IN     std_logic ;
      instruction_word_dc : OUT    word_t 
   );
   END COMPONENT;
   COMPONENT mem_mode_mux
   PORT (
      alu_result_mem     : IN     word_t ;
      data_memory_result : IN     word_t ;
      mem_mode_mem       : IN     mem_mode_t ;
      mem_result_mem     : OUT    word_t 
   );
   END COMPONENT;
   COMPONENT mem_wb_pipeline_reg
   PORT (
      clk            : IN     std_logic ;
      mem_result_mem : IN     word_t ;
      rd_addr_mem    : IN     register_file_t ;
      res_n          : IN     std_logic ;
      mem_result_wb  : OUT    word_t ;
      rd_addr_wb     : OUT    register_file_t 
   );
   END COMPONENT;
   COMPONENT pc_inc
   PORT (
      pc_if : IN     std_logic_vector (7 DOWNTO 0);
      pc_pf : OUT    std_logic_vector (7 DOWNTO 0)
   );
   END COMPONENT;
   COMPONENT pf_if_pipeline_reg
   PORT (
      clk      : IN     std_logic ;
      pc_pf    : IN     std_logic_vector (7 DOWNTO 0);
      res_n    : IN     std_logic ;
      stall_dc : IN     std_logic ;
      pc_if    : OUT    std_logic_vector (7 DOWNTO 0)
   );
   END COMPONENT;
   COMPONENT register_file
   PORT (
      clk           : IN     std_logic ;
      mem_result_wb : IN     word_t ;
      rd_addr_wb    : IN     register_file_t ;
      res_n         : IN     std_logic ;
      rs1_addr      : IN     register_file_t ;
      rs2_addr      : IN     register_file_t ;
      rs1_dc        : OUT    word_t ;
      rs2_dc        : OUT    word_t 
   );
   END COMPONENT;
   COMPONENT rom
   PORT (
      clk                 : IN     std_logic ;
      pc_if               : IN     std_logic_vector (7 DOWNTO 0);
      res_n               : IN     std_logic ;
      instruction_word_if : OUT    word_t 
   );
   END COMPONENT;
   COMPONENT rs1_fwd_mux
   PORT (
      alu_result_mem : IN     word_t ;
      fwd_rs1_ex     : IN     fwd_select_t ;
      mem_result_wb  : IN     word_t ;
      rs1_ex         : IN     word_t ;
      operand_a      : OUT    word_t 
   );
   END COMPONENT;
   COMPONENT rs2_fwd_mux
   PORT (
      alu_result_mem  : IN     word_t ;
      fwd_rs2_ex      : IN     fwd_select_t ;
      mem_result_wb   : IN     word_t ;
      rs2_ex          : IN     word_t ;
      rs2_fwd_mux_out : OUT    word_t 
   );
   END COMPONENT;
   COMPONENT rs2_mux
   PORT (
      imm_ex          : IN     word_t ;
      imm_to_alu_ex   : IN     std_logic ;
      rs2_fwd_mux_out : IN     word_t ;
      operand_b       : OUT    word_t 
   );
   END COMPONENT;
   COMPONENT store_data_fwd_mux
   PORT (
      fwd_store_data_mem : IN     std_logic ;
      mem_result_wb      : IN     word_t ;
      rs2_mem            : IN     word_t ;
      store_data         : OUT    word_t 
   );
   END COMPONENT;

   -- Optional embedded configurations
   -- pragma synthesis_off
   FOR ALL : alu USE ENTITY RISCV_Processor_lib.alu;
   FOR ALL : data_memory USE ENTITY RISCV_Processor_lib.data_memory;
   FOR ALL : dc_ex_pipeline_reg USE ENTITY RISCV_Processor_lib.dc_ex_pipeline_reg;
   FOR ALL : decoder USE ENTITY RISCV_Processor_lib.decoder;
   FOR ALL : ex_mem_pipeline_reg USE ENTITY RISCV_Processor_lib.ex_mem_pipeline_reg;
   FOR ALL : if_dc_pipeline_reg USE ENTITY RISCV_Processor_lib.if_dc_pipeline_reg;
   FOR ALL : mem_mode_mux USE ENTITY RISCV_Processor_lib.mem_mode_mux;
   FOR ALL : mem_wb_pipeline_reg USE ENTITY RISCV_Processor_lib.mem_wb_pipeline_reg;
   FOR ALL : pc_inc USE ENTITY RISCV_Processor_lib.pc_inc;
   FOR ALL : pf_if_pipeline_reg USE ENTITY RISCV_Processor_lib.pf_if_pipeline_reg;
   FOR ALL : register_file USE ENTITY RISCV_Processor_lib.register_file;
   FOR ALL : rom USE ENTITY RISCV_Processor_lib.rom;
   FOR ALL : rs1_fwd_mux USE ENTITY RISCV_Processor_lib.rs1_fwd_mux;
   FOR ALL : rs2_fwd_mux USE ENTITY RISCV_Processor_lib.rs2_fwd_mux;
   FOR ALL : rs2_mux USE ENTITY RISCV_Processor_lib.rs2_mux;
   FOR ALL : store_data_fwd_mux USE ENTITY RISCV_Processor_lib.store_data_fwd_mux;
   -- pragma synthesis_on


BEGIN

   -- Instance port mappings.
   alu_i : alu
      PORT MAP (
         alu_mode_ex   => alu_mode_ex,
         operand_a     => operand_a,
         operand_b     => operand_b,
         alu_result_ex => alu_result_ex
      );
   data_memory_i : data_memory
      PORT MAP (
         alu_result_mem     => alu_result_mem,
         clk                => clk,
         mem_mode_mem       => mem_mode_mem,
         res_n              => res_n,
         store_data         => store_data,
         data_memory_result => data_memory_result
      );
   dc_ex_pipeline_reg_i : dc_ex_pipeline_reg
      PORT MAP (
         alu_mode_dc       => alu_mode_dc,
         clk               => clk,
         fwd_rs1_dc        => fwd_rs1_dc,
         fwd_rs2_dc        => fwd_rs2_dc,
         fwd_store_data_dc => fwd_store_data_dc,
         imm_dc            => imm_dc,
         imm_to_alu_dc     => imm_to_alu_dc,
         mem_mode_dc       => mem_mode_dc,
         rd_addr_dc        => rd_addr_dc,
         res_n             => res_n,
         rs1_dc            => rs1_dc,
         rs2_dc            => rs2_dc,
         alu_mode_ex       => alu_mode_ex,
         fwd_rs1_ex        => fwd_rs1_ex,
         fwd_rs2_ex        => fwd_rs2_ex,
         fwd_store_data_ex => fwd_store_data_ex,
         imm_ex            => imm_ex,
         imm_to_alu_ex     => imm_to_alu_ex,
         mem_mode_ex       => mem_mode_ex,
         rd_addr_ex        => rd_addr_ex,
         rs1_ex            => rs1_ex,
         rs2_ex            => rs2_ex
      );
   decoder_i : decoder
      PORT MAP (
         instruction_word_dc => instruction_word_dc,
         mem_mode_ex         => mem_mode_ex,
         rd_addr_ex          => rd_addr_ex,
         rd_addr_mem         => rd_addr_mem,
         alu_mode_dc         => alu_mode_dc,
         fwd_rs1_dc          => fwd_rs1_dc,
         fwd_rs2_dc          => fwd_rs2_dc,
         fwd_store_data_dc   => fwd_store_data_dc,
         imm_dc              => imm_dc,
         imm_to_alu_dc       => imm_to_alu_dc,
         mem_mode_dc         => mem_mode_dc,
         rd_addr_dc          => rd_addr_dc,
         rs1_addr            => rs1_addr,
         rs2_addr            => rs2_addr,
         stall_dc            => stall_dc
      );
   ex_mem_pipeline_reg_i : ex_mem_pipeline_reg
      PORT MAP (
         alu_result_ex      => alu_result_ex,
         clk                => clk,
         fwd_store_data_ex  => fwd_store_data_ex,
         mem_mode_ex        => mem_mode_ex,
         rd_addr_ex         => rd_addr_ex,
         res_n              => res_n,
         rs2_fwd_mux_out    => rs2_fwd_mux_out,
         alu_result_mem     => alu_result_mem,
         fwd_store_data_mem => fwd_store_data_mem,
         mem_mode_mem       => mem_mode_mem,
         rd_addr_mem        => rd_addr_mem,
         rs2_mem            => rs2_mem
      );
   if_dc_pipeline_reg_i : if_dc_pipeline_reg
      PORT MAP (
         clk                 => clk,
         instruction_word_if => instruction_word_if,
         res_n               => res_n,
         stall_dc            => stall_dc,
         instruction_word_dc => instruction_word_dc
      );
   mem_mode_mux_i : mem_mode_mux
      PORT MAP (
         alu_result_mem     => alu_result_mem,
         data_memory_result => data_memory_result,
         mem_mode_mem       => mem_mode_mem,
         mem_result_mem     => mem_result_mem
      );
   mem_wb_pipeline_reg_i : mem_wb_pipeline_reg
      PORT MAP (
         clk            => clk,
         mem_result_mem => mem_result_mem,
         rd_addr_mem    => rd_addr_mem,
         res_n          => res_n,
         mem_result_wb  => mem_result_wb,
         rd_addr_wb     => rd_addr_wb
      );
   pc_inc_i : pc_inc
      PORT MAP (
         pc_if => pc_if,
         pc_pf => pc_pf
      );
   pf_if_pipeline_reg_i : pf_if_pipeline_reg
      PORT MAP (
         clk      => clk,
         pc_pf    => pc_pf,
         res_n    => res_n,
         stall_dc => stall_dc,
         pc_if    => pc_if
      );
   register_file_i : register_file
      PORT MAP (
         clk           => clk,
         mem_result_wb => mem_result_wb,
         rd_addr_wb    => rd_addr_wb,
         res_n         => res_n,
         rs1_addr      => rs1_addr,
         rs2_addr      => rs2_addr,
         rs1_dc        => rs1_dc,
         rs2_dc        => rs2_dc
      );
   rom_i : rom
      PORT MAP (
         clk                 => clk,
         pc_if               => pc_if,
         res_n               => res_n,
         instruction_word_if => instruction_word_if
      );
   rs1_fwd_mux_i : rs1_fwd_mux
      PORT MAP (
         alu_result_mem => alu_result_mem,
         fwd_rs1_ex     => fwd_rs1_ex,
         mem_result_wb  => mem_result_wb,
         rs1_ex         => rs1_ex,
         operand_a      => operand_a
      );
   rs2_fwd_mux_i : rs2_fwd_mux
      PORT MAP (
         alu_result_mem  => alu_result_mem,
         fwd_rs2_ex      => fwd_rs2_ex,
         mem_result_wb   => mem_result_wb,
         rs2_ex          => rs2_ex,
         rs2_fwd_mux_out => rs2_fwd_mux_out
      );
   rs2_mux_i : rs2_mux
      PORT MAP (
         imm_ex          => imm_ex,
         imm_to_alu_ex   => imm_to_alu_ex,
         rs2_fwd_mux_out => rs2_fwd_mux_out,
         operand_b       => operand_b
      );
   store_data_fwd_mux_i : store_data_fwd_mux
      PORT MAP (
         fwd_store_data_mem => fwd_store_data_mem,
         mem_result_wb      => mem_result_wb,
         rs2_mem            => rs2_mem,
         store_data         => store_data
      );

END struct;
